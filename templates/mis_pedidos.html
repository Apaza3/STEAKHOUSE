{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Historial de Pedidos{% endblock %}

{% block extra_css %}
<style>
    /* =========================================
       ESTILOS "CUENTA DE LUJO" (RECEIPT STYLE)
       ========================================= */

    /* 1. FONDO GENERAL */
    .pedidos-wrapper {
        min-height: 100vh;
        /* Imagen de fondo solicitada */
        background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.95)), url("{% static 'core/img/fondo_mis_pedidos.png' %}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        padding-bottom: 60px;
    }

    /* 2. ENCABEZADO */
    .page-header {
        text-align: center;
        padding: 50px 0 30px 0;
    }
    .page-header img {
        width: 100px;
        filter: drop-shadow(0 0 15px rgba(192, 154, 91, 0.4));
        margin-bottom: 20px;
    }

    /* 3. TARJETA DE PEDIDO (BILL FOLDER STYLE) */
    .bill-card {
        background-color: #1a1a1a;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 40px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        position: relative;
        border-top: 3px solid #c09a5b; /* Borde dorado arriba */
        transition: transform 0.3s ease;
    }

    .bill-card:hover {
        transform: translateY(-5px);
    }

    /* CABECERA DEL BILL */
    .bill-header {
        background-color: #222;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px dashed #444; /* Línea de corte de recibo */
    }

    .order-id {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        color: #fff;
        margin: 0;
    }
    .order-date {
        color: #888;
        font-size: 0.85rem;
        font-family: monospace;
        margin-top: 5px;
    }

    /* CUERPO DEL BILL */
    .bill-body {
        padding: 25px 30px;
    }

    /* LISTA DE ITEMS */
    .item-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .item-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .item-qty {
        background-color: #333;
        color: #fff;
        font-weight: bold;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-right: 15px;
        min-width: 30px;
        text-align: center;
    }

    .item-name {
        color: #ddd;
        font-size: 1.1rem;
        flex-grow: 1;
        font-family: 'Playfair Display', serif;
    }

    .item-price {
        color: #c09a5b;
        font-weight: 600;
        font-size: 1rem;
    }

    /* PIE DEL BILL (TOTAL) */
    .bill-footer {
        background-color: #151515;
        padding: 20px 30px;
        border-top: 2px solid #c09a5b;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .total-label {
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #666;
        font-size: 0.9rem;
    }

    .total-amount {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        color: #fff;
        text-shadow: 0 0 10px rgba(192,154,91,0.3);
    }

    /* BADGES DE ESTADO (ESTILIZADOS) */
    .status-pill {
        padding: 6px 15px;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 1px solid;
    }
    
    .st-pendiente { border-color: #f1c40f; color: #f1c40f; background: rgba(241, 196, 15, 0.1); }
    .st-cocinando { border-color: #e67e22; color: #e67e22; background: rgba(230, 126, 34, 0.1); }
    .st-listo     { border-color: #3498db; color: #3498db; background: rgba(52, 152, 219, 0.1); }
    .st-entregado { border-color: #2ecc71; color: #2ecc71; background: rgba(46, 204, 113, 0.1); }
    .st-cancelado { border-color: #e74c3c; color: #e74c3c; background: rgba(231, 76, 60, 0.1); opacity: 0.7; }

</style>
{% endblock %}

{% block content %}
<div class="pedidos-wrapper">
    <div class="container">
        
        <div class="page-header animate__animated animate__fadeInDown">
            <img src="{% static 'core/img/webres.png' %}" alt="The Steakhouse">
            <h1 class="text-white font-serif-display display-5">Historial de Pedidos</h1>
            <p class="text-secondary" style="letter-spacing: 2px;">Tus experiencias culinarias</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                
                {% if pedidos %}
                    {% for pedido in pedidos %}
                    <div class="bill-card animate__animated animate__fadeInUp" style="animation-delay: {{ forloop.counter0 }}00ms;">
                        
                        <div class="bill-header">
                            <div>
                                <h3 class="order-id">Orden #{{ pedido.id }}</h3>
                                <div class="order-date">
                                    <i class="far fa-calendar-alt me-1"></i> {{ pedido.fecha_pedido|date:"d M Y" }} 
                                    <span class="mx-2">•</span> 
                                    <i class="far fa-clock me-1"></i> {{ pedido.fecha_pedido|date:"H:i" }}
                                </div>
                            </div>
                            
                            <div>
                                {% if pedido.estado_pedido == 'PENDIENTE' %}
                                    <span class="status-pill st-pendiente">En Espera</span>
                                {% elif pedido.estado_pedido == 'EN_PREPARACION' %}
                                    <span class="status-pill st-cocinando"><i class="fas fa-fire me-1"></i> Cocinando</span>
                                {% elif pedido.estado_pedido == 'LISTO' %}
                                    <span class="status-pill st-listo"><i class="fas fa-bell me-1"></i> Listo</span>
                                {% elif pedido.estado_pedido == 'ENTREGADO' %}
                                    <span class="status-pill st-entregado"><i class="fas fa-check me-1"></i> Entregado</span>
                                {% elif pedido.estado_pedido == 'CANCELADO' %}
                                    <span class="status-pill st-cancelado">Cancelado</span>
                                {% else %}
                                    <span class="status-pill bg-secondary text-white">{{ pedido.estado_pedido }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="bill-body">
                            <h6 class="text-muted small text-uppercase mb-4" style="letter-spacing: 1px;">Detalle del Consumo</h6>
                            
                            {% for detalle in pedido.detalles.all %}
                            <div class="item-row">
                                <div class="d-flex align-items-center">
                                    <span class="item-qty">{{ detalle.cantidad }}x</span>
                                    <span class="item-name">{{ detalle.producto.nombre_producto }}</span>
                                </div>
                                <span class="item-price">{{ detalle.subtotal|intcomma }} Bs.</span>
                            </div>
                            {% empty %}
                                <p class="text-center text-muted fst-italic">No hay detalles disponibles.</p>
                            {% endfor %}
                        </div>

                        <div class="bill-footer">
                            <span class="total-label">Total Pagado</span>
                            <span class="total-amount">{{ pedido.total|intcomma }} Bs.</span>
                        </div>

                    </div>
                    {% endfor %}

                {% else %}
                    <div class="text-center py-5 animate__animated animate__fadeIn">
                        <div class="mb-4">
                            <i class="fas fa-utensils fa-4x text-muted opacity-25"></i>
                        </div>
                        <h3 class="text-white font-serif-display mb-3">Aún no has ordenado</h3>
                        <p class="text-white-50 mb-4">Explora nuestro menú y disfruta de la mejor carne.</p>
                        <a href="{% url 'menu_page' %}" class="btn btn-primary-gold rounded-pill px-5 py-2 text-uppercase fw-bold shadow">
                            Ir al Menú
                        </a>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endblock %}