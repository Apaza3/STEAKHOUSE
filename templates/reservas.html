{% extends 'base.html' %}
{% load static %}

{% block title %}Reservar Mesa{% endblock %}

{% block body_class %}body-reservas{% endblock %}

{% block extra_css %}
<style>
    /* =========================================
       1. LAYOUT PRINCIPAL (PC GRANDE Y CENTRADO)
       ========================================= */
    .dashboard-wrapper {
        min-height: calc(100vh - 80px);
        width: 100%;
        display: flex;
        align-items: center; /* Centrado Vertical */
        justify-content: center; /* Centrado Horizontal */
        padding: 20px 0;
        overflow-x: hidden; 
    }

    /* Contenedor de las 2 tarjetas */
    .cards-container-grid {
        display: flex;
        gap: 30px;
        width: 100%;
        max-width: 1300px; 
        height: 600px;
        padding: 0 20px;
        margin: 0 auto; /* CENTRADO HORIZONTAL */
    }

    /* Estilo COMÚN (Negro Sólido) */
    .independent-card {
        background-color: #121212; 
        border: 1px solid rgba(192, 154, 91, 0.3);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.9);
        display: flex;
        flex-direction: column;
        /* overflow: hidden;  <--- ELIMINADO PARA QUE EL SELECT NO SE CORTE */
    }

    /* --- TARJETA IZQUIERDA (Formulario) --- */
    .card-form {
        flex: 0 0 40%; /* Ancho fijo equilibrado */
        padding: 35px 40px;
        justify-content: center; 
        gap: 20px;
        position: relative; /* Necesario para que el z-index del select funcione bien si hiciera falta */
        z-index: 2; /* Asegura que el formulario esté por encima si algo se solapa */
    }

    /* --- TARJETA DERECHA (Mapa) --- */
    .card-map {
        flex: 1; 
        position: relative;
        background-color: #121212;
        padding: 25px;
        /* overflow: hidden; Mantengo el hidden aquí para que el scroll de las mesas no se salga */
         overflow: hidden;
         border-radius: 16px; /* Aseguro el borde redondeado aquí */
    }

    /* =========================================
       2. ELEMENTOS UI
       ========================================= */
    .brand-logo-ui {
        height: 70px;
        width: auto;
        display: block;
        margin: 0 auto 15px auto;
    }

    .ui-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #c09a5b;
        margin-bottom: 5px;
        letter-spacing: 1px;
        font-weight: 700;
        display: block;
    }

    /* Inputs y Selects */
    .form-control-ui {
        background-color: rgba(255, 255, 255, 0.07) !important;
        border: 1px solid #444 !important;
        color: #fff !important;
        font-size: 1rem !important;
        padding: 10px 15px !important;
        height: 48px !important;
        border-radius: 8px;
    }
    /* Estilo específico para que las opciones del select sean legibles */
    .form-control-ui option {
        background-color: #121212;
        color: #fff;
    }
    .form-control-ui:focus {
        border-color: #c09a5b !important;
        background-color: rgba(255, 255, 255, 0.12) !important;
        box-shadow: none !important;
    }

    /* Botones Pago */
    .pago-grid { display: flex; gap: 12px; margin-bottom: 20px; }
    .btn-pago-ui {
        flex: 1;
        background: rgba(255,255,255,0.05);
        border: 1px solid #555;
        color: #bbb;
        padding: 0;
        height: 50px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        font-size: 0.9rem;
        transition: 0.2s;
    }
    .btn-pago-ui:hover { border-color: #c09a5b; color: #fff; background: rgba(255,255,255,0.08); }
    .btn-pago-ui.active { background: #c09a5b; border-color: #c09a5b; color: #000; font-weight: 800; }

    /* Alerta compacta */
    .alert-compact {
        padding: 10px;
        font-size: 0.85rem;
        margin-bottom: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Botón Confirmar */
    .btn-confirm-large {
        font-size: 1.1rem !important;
        padding: 14px !important;
        letter-spacing: 2px !important;
    }

    /* Checkboxes */
    .form-check-label.small { font-size: 0.85rem !important; color: #ccc !important; }
    .form-check-input { transform: scale(1.2); margin-right: 8px; margin-top: 0.25em; }

    /* --- MAPA DE MESAS --- */
    #contenedor-mesas {
        display: grid;
        grid-template-columns: repeat(3, 1fr); 
        gap: 15px;
        overflow-y: auto;
        padding: 10px;
        align-content: start;
        margin-top: 20px;
        margin-bottom: 60px; 
        max-height: 480px; /* Altura máxima para el scroll interno */
    }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    /* Tarjeta Mesa */
    .mesa-content {
        background: rgba(255,255,255,0.05);
        border: 1px solid #444;
        border-radius: 10px;
        padding: 15px 5px !important;
        min-height: 110px !important; /* Mesas más altas */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
        cursor: pointer;
        position: relative;
    }
    .mesa-content:hover { border-color: #c09a5b; background: rgba(192, 154, 91, 0.1); }
    
    /* Iconos y Texto mesa */
    .icon-mesa { font-size: 2rem !important; margin-bottom: 5px !important; }
    .mesa-content h5 { font-size: 1rem !important; margin: 0 !important; color: #fff; }
    .mesa-content small { font-size: 0.8rem !important; color: #bbb; white-space: nowrap; /* Evita que "personas" salte de linea */ }
    
    /* Estados visuales dentro de la mesa */
    .status-text { font-size: 0.7rem; font-weight: bold; margin-top: 4px; text-transform: uppercase; }
    .badge-premium { position: absolute; top: 5px; right: 5px; font-size: 0.6rem; background: #c09a5b; color: #000; padding: 2px 6px; border-radius: 10px; font-weight: bold; }

    /* Selección */
    .mesa-card-input:checked + .mesa-content {
        background: #c09a5b !important;
        border-color: #c09a5b !important;
    }
    .mesa-card-input:checked + .mesa-content h5,
    .mesa-card-input:checked + .mesa-content small,
    .mesa-card-input:checked + .mesa-content i,
    .mesa-card-input:checked + .mesa-content .status-text { color: #000 !important; }

    /* =========================================
       3. RESPONSIVE
       ========================================= */
    @media (max-width: 991px) {
        .dashboard-wrapper {
            display: block; 
            height: auto; 
            padding: 15px; 
            overflow-y: auto;
            min-height: 100vh;
        }
        .cards-container-grid {
            flex-direction: column;
            height: auto;
            max-width: 100%;
            gap: 25px;
            padding: 0;
        }
        .card-form { 
            width: 100%; flex: none; order: 1; padding: 25px; gap: 20px;
        }
        .card-map { 
            width: 100%; flex: none; height: 500px; order: 2; padding: 15px;
        }
        #contenedor-mesas { grid-template-columns: repeat(2, 1fr); }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    
    <form method="POST" id="formReserva" style="width: 100%; height: 100%;">
        {% csrf_token %}
        {{ form.cliente }} 

        <div class="cards-container-grid">
            
            <div class="independent-card card-form">
                
                <div class="text-center">
                    <img src="{% static 'core/img/logo-steakhouse.png' %}" alt="Logo" class="brand-logo-ui">
                </div>

                <div class="row g-3">
                    <div class="col-6">
                        <label class="ui-label">Fecha</label>
                        {{ form.fecha_reserva }} 
                    </div>
                    <div class="col-6">
                        <label class="ui-label">Hora</label>
                        {{ form.hora_reserva }}
                    </div>
                    <div class="col-6">
                        <label class="ui-label">Personas</label>
                        {{ form.numero_personas }}
                    </div>
                    <div class="col-6">
                        <label class="ui-label">Duración</label>
                        {{ form.duracion_horas }}
                    </div>
                </div>

                <div>
                    <label class="ui-label">Método de Pago</label>
                    <div style="display:none;">{{ form.tipo_pago }}</div> 
                    <div class="pago-grid" id="pago-buttons-container"></div>

                    <div id="info-pago-box" class="alert alert-warning alert-compact" style="display:none; background: rgba(255,193,7,0.1); border: 1px solid #ffc107;">
                        <span><i class="fas fa-info-circle me-2 fs-6"></i> Adelanto: <strong>30 Bs</strong></span>
                    </div>

                    <div class="mb-4"> 
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" required id="check_politica_reserva">
                            <label class="form-check-label small text-muted" for="check_politica_reserva" style="cursor: pointer;">
                                Acepto <button type="button" class="btn btn-link p-0 text-warning text-decoration-none fw-bold" data-bs-toggle="modal" data-bs-target="#modalPoliticaReserva">Reglas</button>
                            </label>
                        </div>
                        <div class="form-check" id="box-policy-noshow" style="display: none;">
                            <input class="form-check-input" type="checkbox" id="check_politica_noshow">
                            <label class="form-check-label small text-muted" for="check_politica_noshow" style="cursor: pointer;">
                                Acepto <button type="button" class="btn btn-link p-0 text-danger text-decoration-none fw-bold" data-bs-toggle="modal" data-bs-target="#modalPoliticaNoShow">No Show</button>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary-gold w-100 fw-bold text-uppercase shadow-sm btn-confirm-large">
                        Confirmar Reserva
                    </button>
                </div>
            </div>

            <div class="independent-card card-map">
                <div class="d-flex justify-content-between align-items-center p-3 rounded bg-black bg-opacity-50 border border-secondary border-opacity-25">
                    <small class="text-white text-uppercase fw-bold ps-2 fs-6"><i class="fas fa-map-marker-alt text-warning me-2"></i>Elige Mesa</small>
                    <div id="loadingMesas" class="spinner-border text-warning spinner-border-sm me-2" role="status" style="display:none;"></div>
                </div>
                
                <div id="contenedor-mesas">
                    <div class="text-center w-100 text-muted py-5" style="grid-column: 1 / -1;">
                        <i class="fas fa-search-location fa-4x mb-3 opacity-25"></i>
                        <p class="fs-6">Selecciona fecha y hora.</p>
                    </div>
                </div>

                <div id="mesa-seleccionada-info" class="p-3 text-center bg-success border-top border-success" style="display:none; position: absolute; bottom: 0; left: 0; width: 100%; border-bottom-left-radius: 16px; border-bottom-right-radius: 16px;">
                    <strong class="text-white fs-6" id="txt-mesa-sel">...</strong>
                </div>
            </div>

        </div>
    </form>
</div>

<div class="modal fade" id="modalPoliticaReserva" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border-secondary">
      <div class="modal-header border-bottom border-secondary py-2">
        <h5 class="modal-title text-warning fw-bold"><i class="fas fa-clock me-2"></i>Reglas de la Casa</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="small text-white-50 mb-3">Para mantener la calidad de nuestro servicio y respetar el tiempo de todos, estas reglas son obligatorias:</p>
        <div class="card bg-secondary bg-opacity-10 border-0 mb-2">
            <div class="card-body p-3">
                <h6 class="text-white fw-bold mb-1"><i class="fas fa-stopwatch text-warning me-2"></i>Tolerancia: 15 Minutos</h6>
                <p class="small text-muted mb-0 text-justify">Tu mesa estará reservada solo por <strong>15 minutos</strong> después de la hora marcada. Si llegas tarde, el sistema libera la mesa automáticamente para otros clientes en espera.</p>
            </div>
        </div>
        <div class="card bg-secondary bg-opacity-10 border-0">
            <div class="card-body p-3">
                <h6 class="text-white fw-bold mb-1"><i class="fas fa-hourglass-end text-info me-2"></i>Duración de 2 Horas</h6>
                <p class="small text-muted mb-0 text-justify">La reserva garantiza el uso de la mesa por <strong>2 Horas exactas</strong>. Al finalizar este tiempo, necesitamos la mesa para la siguiente reserva programada. Nuestro personal procederá a cerrar tu cuenta para no perjudicar a los siguientes comensales.</p>
            </div>
        </div>
      </div>
      <div class="modal-footer border-top border-secondary p-2">
        <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Entendido</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalPoliticaNoShow" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark text-light border-secondary shadow-lg">
      <div class="modal-header border-bottom border-secondary py-2">
        <h5 class="modal-title text-danger fw-bold"><i class="fas fa-file-contract me-2"></i>Política Estricta de Reembolsos</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body pt-2 pb-2">
        <div class="alert alert-dark border border-secondary d-flex align-items-center mb-3 py-2">
            <i class="fas fa-info-circle fs-3 me-3 text-white"></i>
            <div class="small text-white-50 text-justify"><strong>IMPORTANTE:</strong> Al realizar el pago, bloqueas esta mesa en nuestro sistema y deja de estar disponible para otros clientes. Por eso, la devolución depende del tiempo que haya pasado <strong>desde que realizas la reserva</strong>, no de la fecha del evento.</div>
        </div>
        <h6 class="text-white fw-bold mb-3 small">Cronómetro de Cancelación (Tiempo tras reservar):</h6>
        <div class="mb-2 p-2 rounded" style="background: rgba(40, 167, 69, 0.15); border-left: 4px solid #28a745;">
            <div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold" style="color: #28a745;">0 - 30 Minutos</span><span class="badge bg-success">Devolución 30 Bs (100%)</span></div>
            <p class="text-white small mb-0 text-justify">Si cancelas dentro de los primeros 30 minutos, se considera un arrepentimiento inmediato y se devuelve el 100% del monto (30 Bs), debido que la mesa prácticamente no generó impacto en la disponibilidad.</p>
        </div>
        <div class="mb-2 p-2 rounded" style="background: rgba(255, 193, 7, 0.15); border-left: 4px solid #ffc107;">
            <div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold" style="color: #ffc107;">30 - 40 Minutos</span><span class="badge bg-warning text-dark">Devolución 20 Bs</span></div>
            <p class="text-white small mb-0 text-justify">Si la cancelación ocurre entre los 30 y 40 minutos, aún es posible liberar la mesa sin mayor perjuicio, por lo que se devuelve un monto reducido de 20 Bs.</p>
        </div>
        <div class="mb-2 p-2 rounded" style="background: rgba(253, 126, 20, 0.15); border-left: 4px solid #fd7e14;">
            <div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold" style="color: #fd7e14;">40 - 60 Minutos</span><span class="badge" style="background: #fd7e14;">Devolución 15 Bs</span></div>
            <p class="text-white small mb-0 text-justify">Cuando la cancelación se realiza entre los 40 y 60 minutos, la mesa ya estuvo bloqueada el tiempo suficiente para afectar potenciales reservas. En este caso, se devuelve únicamente 15 Bs.</p>
        </div>
        <div class="mb-2 p-2 rounded" style="background: rgba(214, 51, 132, 0.15); border-left: 4px solid #d63384;">
            <div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold" style="color: #d63384;">1h - 1h 30m</span><span class="badge" style="background: #d63384;">Devolución 10 Bs</span></div>
            <p class="text-white small mb-0 text-justify">Si decides cancelar entre 1 hora y 1 hora 30 minutos, el bloqueo es considerable y ya representa un impacto operativo significativo; por ello, la devolución se reduce a 10 Bs.</p>
        </div>
        <div class="mb-2 p-2 rounded" style="background: rgba(220, 53, 69, 0.15); border-left: 4px solid #dc3545;">
            <div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold text-danger">Más de 1 hora y media</span><span class="badge bg-danger">0 Bs (Sin Devolución)</span></div>
            <p class="text-white-50 small mb-0 text-justify">Pasados 90 minutos desde la reserva, el sistema asume el compromiso como definitivo. A esa altura, la disponibilidad del establecimiento ya fue afectada por completo, por lo que no se realizan reembolsos.</p>
        </div>
      </div>
      <div class="modal-footer border-top border-secondary p-2 bg-dark">
        <div class="w-100 d-flex justify-content-between align-items-center">
            <small class="text-muted fst-italic" style="font-size: 0.7rem;">* Al marcar la casilla aceptas esta estructura financiera.</small>
            <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Entendido y Aceptado</button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // Referencias DOM
    const dateInput = document.getElementById('{{ form.fecha_reserva.auto_id }}');
    const timeInput = document.getElementById('{{ form.hora_reserva.auto_id }}');
    const durationInput = document.getElementById('{{ form.duracion_horas.auto_id }}');
    const peopleInput = document.getElementById('{{ form.numero_personas.auto_id }}');
    const pagoSelect = document.getElementById('{{ form.tipo_pago.auto_id }}'); 
    
    // Contenedores UI
    const containerMesas = document.getElementById('contenedor-mesas');
    const loading = document.getElementById('loadingMesas');
    const txtMesaSel = document.getElementById('txt-mesa-sel');
    const infoDiv = document.getElementById('mesa-seleccionada-info');
    const infoPagoBox = document.getElementById('info-pago-box');
    const boxPolicyNoShow = document.getElementById('box-policy-noshow');
    const checkNoShow = document.getElementById('check_politica_noshow');

    // Corrección de inputs de tiempo si es necesario
    if(timeInput) {
        timeInput.removeAttribute('min');
        timeInput.removeAttribute('step'); 
    }

    // Estilos inputs (UI del primer código)
    [dateInput, timeInput, durationInput, peopleInput].forEach(input => {
        if(input) input.classList.add('form-control', 'form-control-ui');
    });

    // ----------------------------------------------------
    // GENERAR BOTONES DE PAGO (UI VISUAL)
    // ----------------------------------------------------
    const buttonsContainer = document.getElementById('pago-buttons-container');
    
    if(pagoSelect && pagoSelect.options) {
        Array.from(pagoSelect.options).forEach(option => {
            if(option.value) { 
                let label = option.text;
                let val = option.value;
                
                let icon = '<i class="fas fa-money-bill-wave"></i>';
                if(label.toLowerCase().includes('qr') || label.toLowerCase().includes('transferencia')) icon = '<i class="fas fa-qrcode"></i>';
                if(label.toLowerCase().includes('tarjeta')) icon = '<i class="fas fa-credit-card"></i>';

                let btn = document.createElement('div');
                btn.className = 'btn-pago-ui';
                btn.innerHTML = `${icon}<span>${label}</span>`;
                
                if(pagoSelect.value === val) btn.classList.add('active');

                btn.onclick = function() {
                    // Actualiza el select oculto (importante para la lógica)
                    pagoSelect.value = val;
                    // Actualiza UI visual
                    document.querySelectorAll('.btn-pago-ui').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    // Dispara evento para lógica de políticas
                    pagoSelect.dispatchEvent(new Event('change'));
                };
                buttonsContainer.appendChild(btn);
            }
        });
    }

    // ----------------------------------------------------
    // LOGICA DE MESAS (LÓGICA COMPLETA)
    // ----------------------------------------------------
    window.cargarMesas = function() {
        const fecha = dateInput.value;
        const hora = timeInput.value;
        const duracion = durationInput.value;
        const personas = parseInt(peopleInput.value) || 1;

        if(!fecha || !hora) return;

        loading.style.display = 'block';
        containerMesas.style.opacity = '0.5';

        fetch(`/reservas/api/check-mesas/?fecha=${fecha}&hora=${hora}&duracion=${duracion}`)
            .then(response => response.json())
            .then(data => {
                containerMesas.innerHTML = ''; 
                if(data.mesas && data.mesas.length > 0) {
                    data.mesas.forEach(mesa => {
                        // LÓGICA DE VALIDACIÓN
                        let isPremium = (mesa.tipo && (mesa.tipo.includes('Premium') || mesa.tipo.includes('PREMIUM')));
                        let esAdecuada = mesa.capacidad >= personas;
                        let estaLibre = mesa.estado === 'LIBRE';
                        let esSeleccionable = estaLibre && esAdecuada;

                        // Determinar icono y textos de estado
                        let iconClass = isPremium ? 'fa-crown text-warning' : 'fa-chair text-secondary';
                        let badgeHtml = isPremium ? '<span class="badge-premium">PREMIUM</span>' : '';
                        
                        let textoEstado = '';
                        let colorEstado = '';
                        
                        if(!estaLibre) { 
                            textoEstado = 'OCUPADA'; 
                            colorEstado = 'text-danger'; 
                        } else if (!esAdecuada) { 
                            textoEstado = 'PEQUEÑA'; 
                            colorEstado = 'text-warning'; 
                        } else { 
                            textoEstado = 'LIBRE'; 
                            colorEstado = 'text-success'; 
                        }

                        // RENDERIZADO HTML (TEXTOS CORREGIDOS AQUÍ)
                        let html = `
                        <div class="mesa-selector-container">
                            <label class="mesa-card-label w-100">
                                <input type="radio" name="mesa_id" value="${mesa.id}" class="mesa-card-input" 
                                    onchange="actualizarInfoMesa('${mesa.numero}')" 
                                    required 
                                    ${!esSeleccionable ? 'disabled' : ''}>
                                
                                <div class="mesa-content" style="${!esSeleccionable ? 'opacity:0.4; cursor:not-allowed;' : ''}">
                                    ${badgeHtml}
                                    <i class="fas ${iconClass} icon-mesa"></i>
                                    <h5 class="fw-bold">Mesa ${mesa.numero}</h5>
                                    <small>${mesa.capacidad} personas</small>
                                    <div class="status-text ${colorEstado}">${textoEstado}</div>
                                </div>
                            </label>
                        </div>`;
                        containerMesas.insertAdjacentHTML('beforeend', html);
                    });
                } else {
                    containerMesas.innerHTML = '<div class="col-12 text-center text-muted py-5" style="grid-column: 1 / -1;"><i class="fas fa-calendar-times fa-3x mb-3 opacity-25"></i><p class="m-0">No hay mesas disponibles.</p></div>';
                }
                loading.style.display = 'none';
                containerMesas.style.opacity = '1';
                infoDiv.style.display = 'none';
            })
            .catch(error => { console.error(error); loading.style.display = 'none'; });
    };

    window.actualizarInfoMesa = function(numero) {
        txtMesaSel.innerText = `Mesa ${numero} seleccionada`;
        infoDiv.style.display = 'block';
    };

    // Listeners para recargar mesas
    dateInput.addEventListener('change', cargarMesas);
    timeInput.addEventListener('change', cargarMesas);
    durationInput.addEventListener('change', cargarMesas);
    peopleInput.addEventListener('change', cargarMesas);

    // ----------------------------------------------------
    // LOGICA DE POLÍTICAS
    // ----------------------------------------------------
    function actualizarPoliticas() {
        const metodo = pagoSelect.value;
        
        if(metodo === 'PAGO_ADELANTADO' || metodo === 'TARJETA') {
            infoPagoBox.style.display = 'flex';
            boxPolicyNoShow.style.display = 'block';
            checkNoShow.required = true; 
        } else {
            infoPagoBox.style.display = 'none';
            boxPolicyNoShow.style.display = 'none';
            checkNoShow.required = false;
            checkNoShow.checked = false;
        }
    }

    pagoSelect.addEventListener('change', actualizarPoliticas);

    // Inicialización
    if(dateInput.value && timeInput.value) cargarMesas();
    actualizarPoliticas();
});
</script>
{% endblock %}